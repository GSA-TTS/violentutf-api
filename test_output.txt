/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/pytest_asyncio/plugin.py:208: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform darwin -- Python 3.12.9, pytest-8.3.5, pluggy-1.5.0 -- /Library/Frameworks/Python.framework/Versions/3.12/bin/python3
cachedir: .pytest_cache
metadata: {'Python': '3.12.9', 'Platform': 'macOS-15.5-arm64-arm-64bit', 'Packages': {'pytest': '8.3.5', 'pluggy': '1.5.0'}, 'Plugins': {'xdist': '3.7.0', 'anyio': '4.9.0', 'env': '1.1.5', 'json-report': '1.5.0', 'httpx': '0.35.0', 'timeout': '2.4.0', 'metadata': '3.1.1', 'cov': '6.2.1', 'Faker': '37.3.0', 'mock': '3.14.1', 'asyncio': '1.0.0'}}
rootdir: /Users/tamnguyen/Documents/GitHub/violentutf-api
configfile: pytest.ini
plugins: xdist-3.7.0, anyio-4.9.0, env-1.1.5, json-report-1.5.0, httpx-0.35.0, timeout-2.4.0, metadata-3.1.1, cov-6.2.1, Faker-37.3.0, mock-3.14.1, asyncio-1.0.0
asyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 1377 items

tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_list_api_keys FAILED [  0%]
tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_get_api_key_by_id FAILED [  0%]
tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_create_api_key FAILED [  0%]
tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_create_api_key_duplicate_name FAILED [  0%]
tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_update_api_key FAILED [  0%]
tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_delete_api_key FAILED [  0%]
tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_get_my_api_keys FAILED [  0%]
tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_revoke_api_key FAILED [  0%]
tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_validate_api_key FAILED [  0%]
tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_get_permission_templates FAILED [  0%]

=================================== FAILURES ===================================
____________________ TestAPIKeyEndpoints.test_list_api_keys ____________________
tests/unit/api/test_api_keys.py:130: in test_list_api_keys
    assert response.status_code == status.HTTP_200_OK
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
E    +  and   200 = status.HTTP_200_OK
---------------------------- Captured stdout setup -----------------------------
Test database initialized: sqlite+aiosqlite:///./test_violentutf.db
{"development_mode": true, "event": "Error handlers configured", "logger": "app.core.errors", "level": "info", "timestamp": "2025-07-28T15:25:28.440233Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
{"event": "Security middleware configured", "logger": "app.middleware.security", "level": "info", "timestamp": "2025-07-28T15:25:28.440337Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
------------------------------ Captured log setup ------------------------------
INFO     app.core.errors:errors.py:235 {"development_mode": true, "event": "Error handlers configured", "logger": "app.core.errors", "level": "info", "timestamp": "2025-07-28T15:25:28.440233Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
INFO     app.middleware.security:security.py:125 {"event": "Security middleware configured", "logger": "app.middleware.security", "level": "info", "timestamp": "2025-07-28T15:25:28.440337Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
----------------------------- Captured stdout call -----------------------------
{"event": "Redis cache client created successfully", "logger": "app.utils.cache", "level": "info", "timestamp": "2025-07-28T15:25:28.475548Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
{"event": "Redis cache client initialized", "logger": "app.utils.cache", "level": "info", "timestamp": "2025-07-28T15:25:28.475628Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
{"path": "/api/v1/api-keys/", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.478853Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
------------------------------ Captured log call -------------------------------
INFO     app.utils.cache:cache.py:57 {"event": "Redis cache client created successfully", "logger": "app.utils.cache", "level": "info", "timestamp": "2025-07-28T15:25:28.475548Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
INFO     app.utils.cache:cache.py:71 {"event": "Redis cache client initialized", "logger": "app.utils.cache", "level": "info", "timestamp": "2025-07-28T15:25:28.475628Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
WARNING  app.middleware.request_signing:request_signing.py:72 {"path": "/api/v1/api-keys/", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.478853Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
__________________ TestAPIKeyEndpoints.test_get_api_key_by_id __________________
tests/unit/api/test_api_keys.py:153: in test_get_api_key_by_id
    assert response.status_code == status.HTTP_200_OK
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
E    +  and   200 = status.HTTP_200_OK
----------------------------- Captured stdout call -----------------------------
{"path": "/api/v1/api-keys/63dec03f-620d-487a-a542-07152d71e93a", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.513827Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
------------------------------ Captured log call -------------------------------
WARNING  app.middleware.request_signing:request_signing.py:72 {"path": "/api/v1/api-keys/63dec03f-620d-487a-a542-07152d71e93a", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.513827Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
___________________ TestAPIKeyEndpoints.test_create_api_key ____________________
tests/unit/api/test_api_keys.py:191: in test_create_api_key
    assert response.status_code == status.HTTP_201_CREATED
E   assert 403 == 201
E    +  where 403 = <Response [403 Forbidden]>.status_code
E    +  and   201 = status.HTTP_201_CREATED
----------------------------- Captured stdout call -----------------------------
{"method": "POST", "path": "/api/v1/api-keys", "has_cookie": "***REDACTED***", "has_submitted": false, "event": "csrf_validation_failed", "logger": "app.middleware.csrf", "level": "warning", "timestamp": "2025-07-28T15:25:28.520539Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
------------------------------ Captured log call -------------------------------
WARNING  app.middleware.csrf:csrf.py:91 {"method": "POST", "path": "/api/v1/api-keys", "has_cookie": "***REDACTED***", "has_submitted": false, "event": "csrf_validation_failed", "logger": "app.middleware.csrf", "level": "warning", "timestamp": "2025-07-28T15:25:28.520539Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
____________ TestAPIKeyEndpoints.test_create_api_key_duplicate_name ____________
tests/unit/api/test_api_keys.py:219: in test_create_api_key_duplicate_name
    assert response.status_code == status.HTTP_409_CONFLICT
E   assert 403 == 409
E    +  where 403 = <Response [403 Forbidden]>.status_code
E    +  and   409 = status.HTTP_409_CONFLICT
----------------------------- Captured stdout call -----------------------------
{"method": "POST", "path": "/api/v1/api-keys", "has_cookie": "***REDACTED***", "has_submitted": false, "event": "csrf_validation_failed", "logger": "app.middleware.csrf", "level": "warning", "timestamp": "2025-07-28T15:25:28.526875Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
------------------------------ Captured log call -------------------------------
WARNING  app.middleware.csrf:csrf.py:91 {"method": "POST", "path": "/api/v1/api-keys", "has_cookie": "***REDACTED***", "has_submitted": false, "event": "csrf_validation_failed", "logger": "app.middleware.csrf", "level": "warning", "timestamp": "2025-07-28T15:25:28.526875Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
___________________ TestAPIKeyEndpoints.test_update_api_key ____________________
tests/unit/api/test_api_keys.py:243: in test_update_api_key
    assert response.status_code == status.HTTP_200_OK
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
E    +  and   200 = status.HTTP_200_OK
----------------------------- Captured stdout call -----------------------------
{"path": "/api/v1/api-keys/f2ad8c8d-c4d0-4559-85c8-af2e6419e35e", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.532530Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
------------------------------ Captured log call -------------------------------
WARNING  app.middleware.request_signing:request_signing.py:72 {"path": "/api/v1/api-keys/f2ad8c8d-c4d0-4559-85c8-af2e6419e35e", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.532530Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
___________________ TestAPIKeyEndpoints.test_delete_api_key ____________________
tests/unit/api/test_api_keys.py:263: in test_delete_api_key
    assert response.status_code == status.HTTP_200_OK
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
E    +  and   200 = status.HTTP_200_OK
----------------------------- Captured stdout call -----------------------------
{"path": "/api/v1/api-keys/f1a6b9a2-70f0-443b-b658-04488fa75806", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.537372Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
------------------------------ Captured log call -------------------------------
WARNING  app.middleware.request_signing:request_signing.py:72 {"path": "/api/v1/api-keys/f1a6b9a2-70f0-443b-b658-04488fa75806", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.537372Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
___________________ TestAPIKeyEndpoints.test_get_my_api_keys ___________________
tests/unit/api/test_api_keys.py:285: in test_get_my_api_keys
    assert response.status_code == status.HTTP_200_OK
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
E    +  and   200 = status.HTTP_200_OK
----------------------------- Captured stdout call -----------------------------
{"path": "/api/v1/api-keys/my-keys", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.542613Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
------------------------------ Captured log call -------------------------------
WARNING  app.middleware.request_signing:request_signing.py:72 {"path": "/api/v1/api-keys/my-keys", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.542613Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
___________________ TestAPIKeyEndpoints.test_revoke_api_key ____________________
tests/unit/api/test_api_keys.py:306: in test_revoke_api_key
    assert response.status_code == status.HTTP_200_OK
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
E    +  and   200 = status.HTTP_200_OK
----------------------------- Captured stdout call -----------------------------
{"path": "/api/v1/api-keys/a849de0f-7a61-4832-bf6d-b2e97d0d9be8/revoke", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.547334Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
------------------------------ Captured log call -------------------------------
WARNING  app.middleware.request_signing:request_signing.py:72 {"path": "/api/v1/api-keys/a849de0f-7a61-4832-bf6d-b2e97d0d9be8/revoke", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.547334Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
__________________ TestAPIKeyEndpoints.test_validate_api_key ___________________
tests/unit/api/test_api_keys.py:327: in test_validate_api_key
    assert response.status_code == status.HTTP_200_OK
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
E    +  and   200 = status.HTTP_200_OK
----------------------------- Captured stdout call -----------------------------
{"path": "/api/v1/api-keys/5bef1492-290b-418b-9545-710261a218e9/validate", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.552002Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
------------------------------ Captured log call -------------------------------
WARNING  app.middleware.request_signing:request_signing.py:72 {"path": "/api/v1/api-keys/5bef1492-290b-418b-9545-710261a218e9/validate", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.552002Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
______________ TestAPIKeyEndpoints.test_get_permission_templates _______________
tests/unit/api/test_api_keys.py:344: in test_get_permission_templates
    assert response.status_code == status.HTTP_200_OK
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
E    +  and   200 = status.HTTP_200_OK
----------------------------- Captured stdout call -----------------------------
{"path": "/api/v1/api-keys/permission-templates", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.555813Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
------------------------------ Captured log call -------------------------------
WARNING  app.middleware.request_signing:request_signing.py:72 {"path": "/api/v1/api-keys/permission-templates", "has_signature": false, "has_timestamp": false, "has_api_key": "***REDACTED***", "has_nonce": false, "event": "request_signing_headers_missing", "logger": "app.middleware.request_signing", "level": "warning", "timestamp": "2025-07-28T15:25:28.555813Z", "service": "ViolentUTF API", "environment": "development", "version": "1.0.0"}
--------------------------- Captured stdout teardown ---------------------------
Test database cleaned up
=============================== warnings summary ===============================
../../../../../Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/formparsers.py:12
  /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/formparsers.py:12: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

../../../../../Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/passlib/utils/__init__.py:854
  /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
    from crypt import crypt as _crypt

../../../../../Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/pydantic/_internal/_config.py:291
  /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/pydantic/_internal/_config.py:291: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.9/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

../../../../../Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlalchemy/orm/decl_api.py:0
  /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlalchemy/orm/decl_api.py:0: PytestCollectionWarning: cannot collect test class 'Base' because it has a __init__ constructor (from: tests/unit/models/test_mixins.py)

tests/unit/models/test_mixins.py:26
  /Users/tamnguyen/Documents/GitHub/violentutf-api/tests/unit/models/test_mixins.py:26: PytestCollectionWarning: cannot collect test class 'TestModel' because it has a __init__ constructor (from: tests/unit/models/test_mixins.py)
    class TestModel(TestBase, BaseModelMixin):

tests/unit/test_errors.py:23
  /Users/tamnguyen/Documents/GitHub/violentutf-api/tests/unit/test_errors.py:23: PytestCollectionWarning: cannot collect test class 'TestModel' because it has a __init__ constructor (from: tests/unit/test_errors.py)
    class TestModel(BaseModel):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_list_api_keys
FAILED tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_get_api_key_by_id
FAILED tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_create_api_key
FAILED tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_create_api_key_duplicate_name
FAILED tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_update_api_key
FAILED tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_delete_api_key
FAILED tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_get_my_api_keys
FAILED tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_revoke_api_key
FAILED tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_validate_api_key
FAILED tests/unit/api/test_api_keys.py::TestAPIKeyEndpoints::test_get_permission_templates
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 10 failures !!!!!!!!!!!!!!!!!!!!!!!!!!
======================== 10 failed, 6 warnings in 0.61s ========================
